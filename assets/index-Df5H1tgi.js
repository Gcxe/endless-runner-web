(function(){const D=document.createElement("link").relList;if(D&&D.supports&&D.supports("modulepreload"))return;for(const T of document.querySelectorAll('link[rel="modulepreload"]'))wt(T);new MutationObserver(T=>{for(const v of T)if(v.type==="childList")for(const B of v.addedNodes)B.tagName==="LINK"&&B.rel==="modulepreload"&&wt(B)}).observe(document,{childList:!0,subtree:!0});function R(T){const v={};return T.integrity&&(v.integrity=T.integrity),T.referrerPolicy&&(v.referrerPolicy=T.referrerPolicy),T.crossOrigin==="use-credentials"?v.credentials="include":T.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function wt(T){if(T.ep)return;T.ep=!0;const v=R(T);fetch(T.href,v)}})();console.log("main.js loaded");const to=document.getElementById("c");if(!to)throw new Error("Canvas #c not found");window.addEventListener("error",Mt=>{const D=document.getElementById("c");if(!D)return;const R=D.getContext("2d");R.setTransform(1,0,0,1,0,0),R.clearRect(0,0,D.width,D.height),R.fillStyle="black",R.fillRect(0,0,D.width,D.height),R.fillStyle="red",R.font="16px monospace",R.fillText("JS ERROR:",10,20),R.fillText(String(Mt.message),10,45)});(()=>{const T=(t,e,l)=>t<e?e:t>l?l:t,v=t=>t*t*(3-2*t),B=(t,e)=>t+Math.random()*(e-t),W=(t,e)=>t+Math.floor(Math.random()*(e-t+1)),L=Math.PI*2,Y=document.getElementById("c");if(!Y)throw new Error("Missing <canvas id='c'></canvas> in HTML.");const o=Y.getContext("2d");let bt=0,St=0,K=0,Z=0,V=1;function st(){K=window.innerWidth,Z=window.innerHeight,V=Math.max(1,Math.min(2,window.devicePixelRatio||1)),Y.width=Math.floor(K*V),Y.height=Math.floor(Z*V),Y.style.width=K+"px",Y.style.height=Z+"px",o.setTransform(V,0,0,V,0,0),bt=Math.floor((K-960)/2),St=Math.floor((Z-540)/2),document.title="Endless Runner"}window.addEventListener("resize",st),st();const I=t=>`rgb(${t[0]},${t[1]},${t[2]})`,Gt=(t,e)=>`rgba(${t[0]},${t[1]},${t[2]},${e})`,ne=[70,220,140],ce=[255,215,90],Tt=[240,240,245],nt=[200,200,210],jt="runner_save_v2_polished";function Bt(){return{money:0,best_score:0,cosmetics:{player:"Sky",platform:"Pearl",spike:"Crimson",background:"Midnight"},owned:{player:["Sky"],platform:["Pearl"],spike:["Crimson"],background:["Midnight"]},upgrades:{jump:0,coyote:0,coin_mult:0,magnet:0},settings:{screenshake:!0,particles:!0,show_fps:!1,fullscreen:!1,sound:!0}}}function Lt(t,e){for(const l of Object.keys(e)){const a=e[l];l in t?a&&typeof a=="object"&&!Array.isArray(a)&&t[l]&&typeof t[l]=="object"&&!Array.isArray(t[l])&&Lt(t[l],a):t[l]=a}}function F(t){try{localStorage.setItem(jt,JSON.stringify(t))}catch{}}function le(){const t=Bt();try{const e=localStorage.getItem(jt);if(!e)return t;const l=JSON.parse(e);return Lt(l,t),l}catch{return t}}let f=le();async function Et(t){f.settings.fullscreen=!!t,F(f);try{t?document.fullscreenElement||await document.documentElement.requestFullscreen():document.fullscreenElement&&await document.exitFullscreen()}catch{}st()}document.addEventListener("fullscreenchange",()=>{const t=!!document.fullscreenElement;f.settings.fullscreen!==t&&(f.settings.fullscreen=t,F(f)),st()});let ct=null;function Ft(){if(!f.settings.sound)return null;if(!ct)try{ct=new(window.AudioContext||window.webkitAudioContext)}catch{ct=null}return ct}function X(t,e=.07,l="sine",a=.03){const r=Ft();if(!r)return;const n=r.currentTime,c=r.createOscillator(),i=r.createGain();c.type=l,c.frequency.setValueAtTime(t,n),i.gain.setValueAtTime(0,n),i.gain.linearRampToValueAtTime(a,n+.005),i.gain.exponentialRampToValueAtTime(1e-4,n+e),c.connect(i),i.connect(r.destination),c.start(n),c.stop(n+e+.02)}const E={click:()=>X(650,.06,"triangle",.02),jump:()=>{X(420,.05,"square",.02),X(740,.04,"sine",.015)},coin:()=>{X(980,.05,"sine",.02),X(1280,.05,"triangle",.015)},dead:()=>{X(160,.12,"sawtooth",.03),X(90,.16,"square",.02)}};function Nt(){const t=Ft();t&&t.state==="suspended"&&t.resume().catch(()=>{})}window.addEventListener("pointerdown",Nt,{once:!0}),window.addEventListener("keydown",Nt,{once:!0});const Ht={player:{Sky:{price:0,color:[120,200,255]},Neon:{price:200,color:[100,255,180]},Gold:{price:400,color:[255,215,90]},Violet:{price:300,color:[190,120,255]},Void:{price:600,color:[30,35,48]}},platform:{Pearl:{price:0,color:[210,210,220]},Stone:{price:150,color:[170,175,185]},Mint:{price:250,color:[150,255,210]},Amber:{price:300,color:[255,190,120]},Obsidian:{price:500,color:[55,60,70]}},spike:{Crimson:{price:0,color:[255,90,90]},Acid:{price:180,color:[170,255,80]},Ice:{price:220,color:[140,220,255]},Royal:{price:320,color:[210,130,255]},Coal:{price:450,color:[70,75,85]}},background:{Midnight:{price:0,color:[16,18,24]},Dusk:{price:180,color:[24,20,30]},Ocean:{price:220,color:[10,22,32]},Forest:{price:260,color:[14,26,20]},Sunset:{price:320,color:[28,16,18]}}},z={jump:{name:"Jump Power",max:6,base_cost:140,cost_step:80},coyote:{name:"Coyote Time",max:6,base_cost:110,cost_step:70},coin_mult:{name:"Coin Multiplier",max:6,base_cost:170,cost_step:90},magnet:{name:"Coin Magnet",max:6,base_cost:160,cost_step:85}},Ut=(t,e)=>z[t].base_cost+z[t].cost_step*e,lt=t=>Ht[t][f.cosmetics[t]].color;function qt(t,e){return f.owned[t].includes(e)}function re(t,e){if(qt(t,e)){f.cosmetics[t]=e,F(f),E.click();return}const l=Ht[t][e].price;f.money>=l&&(f.money-=l,f.owned[t].push(e),f.cosmetics[t]=e,F(f),E.click())}function ae(t){const e=f.upgrades[t];if(e>=z[t].max)return;const l=Ut(t,e);f.money>=l&&(f.money-=l,f.upgrades[t]+=1,F(f),E.click())}function ie(t){f.settings[t]=!f.settings[t],F(f),E.click(),t==="fullscreen"&&Et(f.settings.fullscreen)}function fe(){f=Bt(),F(f),Et(!1),O=!1,g=U,tt()}const S=(t,e,l,a)=>({x:t,y:e,w:l,h:a}),rt=t=>({x:t.x,y:t.y,w:t.w,h:t.h}),J=t=>t.x+t.w/2,at=t=>t.y+t.h/2;function it(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function ue(t,e,l,a,r){const n=Math.min(r,l/2,a/2);o.beginPath(),o.moveTo(t+n,e),o.arcTo(t+l,e,t+l,e+a,n),o.arcTo(t+l,e+a,t,e+a,n),o.arcTo(t,e+a,t,e,n),o.arcTo(t,e,t+l,e,n),o.closePath()}function N(t,e,l,a,r,n,c=null,i=2){ue(t,e,l,a,r),o.fillStyle=I(n),o.fill(),c&&(o.lineWidth=i,o.strokeStyle=I(c),o.stroke())}function j(t){if(!t){o.shadowColor="transparent",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0;return}o.shadowColor="rgba(0,0,0,0.35)",o.shadowBlur=14,o.shadowOffsetX=0,o.shadowOffsetY=6}function _(t,e,l,a=34,r=Tt,n="left",c=1){o.globalAlpha=c,o.font=`${a}px system-ui, -apple-system, Segoe UI, Roboto, Arial`,o.fillStyle=I(r),o.textBaseline="top",o.textAlign=n,o.fillText(t,e,l),o.globalAlpha=1}class A{constructor(e,l,a,r="main"){this.r=e,this.label=l,this.onClick=a,this.style=r,this.pressT=0}draw(e,l,a){const r=e>=this.r.x&&e<=this.r.x+this.r.w&&l>=this.r.y&&l<=this.r.y+this.r.h;this.pressT=Math.max(0,this.pressT-a*5);let n,c,i;this.style==="main"?(n=r?[58,64,86]:[40,44,58],c=[120,126,150],i=[248,248,252]):(n=r?[52,58,80]:[34,38,52],c=[100,106,132],i=[242,242,246]);const M=v(this.pressT),h=2+3*M,u=this.r.x+h,y=this.r.y+h,m=this.r.w-h*2,w=this.r.h-h*2;j(!0),N(u,y,m,w,14,n,c,2),j(!1),o.font="34px system-ui, -apple-system, Segoe UI, Roboto, Arial",o.fillStyle=I(i),o.textAlign="center",o.textBaseline="middle",o.fillText(this.label,this.r.x+this.r.w/2,this.r.y+this.r.h/2+M*1.5),o.textBaseline="top",o.textAlign="left"}tryClick(e,l){return e>=this.r.x&&e<=this.r.x+this.r.w&&l>=this.r.y&&l<=this.r.y+this.r.h?(this.pressT=1,this.onClick(),!0):!1}}class he{constructor(e,l,a,r,n,c,i){this.x=e,this.y=l,this.vx=a,this.vy=r,this.life=n,this.r=c,this.col=i,this.maxLife=n}}function ft(t,e,l,a,r,n,c,i,M,h,u,y=!1){for(let m=0;m<a;m++){const w=y?B(-Math.PI,0):B(0,L),p=B(r,n);t.push(new he(e,l,Math.cos(w)*p,Math.sin(w)*p,B(c,i),B(M,h),u))}}function pe(t,e){if(!f.settings.particles){t.length=0;return}const l=1600,a=.985,r=[];for(const n of t)n.life-=e,n.life>0&&(n.vy+=l*e,n.vx*=Math.pow(a,e*60),n.vy*=Math.pow(a,e*60),n.x+=n.vx*e,n.y+=n.vy*e,r.push(n));t.length=0,t.push(...r)}function Q(t,e){o.fillStyle=I(lt("background")),o.fillRect(0,0,960,540);const l=o.createLinearGradient(0,0,0,540);l.addColorStop(0,"rgba(255,255,255,0.05)"),l.addColorStop(1,"rgba(0,0,0,0.18)"),o.fillStyle=l,o.fillRect(0,0,960,540);for(let a=0;a<80;a++){const r=a*173%2880,n=30+a*97%Math.floor(540/2),c=Math.floor((r-t*.18)%1020-30),i=170+Math.floor(60*Math.sin(e*2.1+a));o.fillStyle=`rgb(${i},${i},${i})`,o.beginPath(),o.arc(c,n,1,0,L),o.fill()}for(let a=0;a<8;a++){const r=a*220,n=320,c=Math.floor((r-t*.28)%1220-130);o.fillStyle=I([28,34,48]),o.beginPath(),o.arc(c,n,160,0,L),o.fill()}for(let a=0;a<10;a++){const r=a*190,n=380,c=Math.floor((r-t*.45)%1220-130);o.fillStyle=I([24,30,44]),o.beginPath(),o.arc(c,n,130,0,L),o.fill()}}function de(t,e){const l=t.y+t.h,a=Math.max(14,t.h),r=l-a,n=Math.max(3,Math.floor(t.w/20)),c=t.w/n;o.fillStyle=I(e);for(let i=0;i<n;i++){const M=t.x+i*c,h=t.x+(i+1)*c,u=(M+h)/2;o.beginPath(),o.moveTo(Math.floor(M),Math.floor(l)),o.lineTo(Math.floor(h),Math.floor(l)),o.lineTo(Math.floor(u),Math.floor(r)),o.closePath(),o.fill()}o.strokeStyle=Gt(e,.9),o.lineWidth=1,o.beginPath(),o.moveTo(t.x,l),o.lineTo(t.x+t.w,l),o.stroke()}function me(t,e,l,a){if(l===0)return{pyFloat:e,landed:!1,bumped:!1};const r=Math.floor(Math.abs(l)/6)+1,n=l/r;for(let c=0;c<r;c++){const i=t.y,M=t.y+t.h;if(e+=n,t.y=Math.floor(e),n>0){for(const h of a)if(it(t,h)&&M<=h.y)return t.y=h.y-t.h,{pyFloat:t.y,landed:!0,bumped:!1}}else for(const h of a)if(it(t,h)&&i>=h.y+h.h)return t.y=h.y+h.h,{pyFloat:t.y,landed:!1,bumped:!0}}return{pyFloat:e,landed:!1,bumped:!1}}const U="menu",q="play",ut="shop",kt="settings",Pt="dead";let g=U,O=!1;const Vt=80,$=540-Vt,ye=.55,Xt=320,_e=820,xe=7,ge=2100,Me=880,we=1500,be=.1,Se=.12,Te=150,Ee=340,He=160,ke=380,Pe=18,Ie=28,It=[0,70,120,170],Ae=.6,ve=1,Ce=.7,De=.52,Re=.62;function We(){const t=f.upgrades;return{jumpV:Me+50*t.jump,coyoteT:be+.02*t.coyote,coinMul:1+.2*t.coin_mult,magnetPx:0+26*t.magnet}}const k={playerSquash:0,playerStretch:0,coinPulse:0,uiFade:1};function zt(){const{jumpV:t,coyoteT:e,coinMul:l,magnetPx:a}=We(),r={cam_x:0,speed:Xt,score:0,score_f:0,coins_run:0,player:S(160,$-58,44,58),py:$-58,vy:0,on_ground:!0,coyote:0,jump_buf:0,jump_v:t,coyote_t:e,coin_mul:l,magnet_px:a,platforms:[],hazards:[],coins_list:[],particles:[],shake_t:0,shake_mag:0,next_spawn_x:0,last_platform_top:$,last_hazard_x:-1e7,jump_cut:!1,jump_time:0},n=S(0,$-24,2160,24);return r.platforms.push(n),r.next_spawn_x=n.x+n.w+140,r.last_platform_top=n.y,r}let s=zt();function Yt(t,e=.14){f.settings.screenshake&&(s.shake_mag=Math.max(s.shake_mag,t),s.shake_t=Math.max(s.shake_t,e))}function At(){const t=s.cam_x;for(;s.next_spawn_x<t+960*2.2;)$e()}function Oe(){const t=s.cam_x,e=l=>l.x+l.w>=t-280;s.platforms=s.platforms.filter(e),s.hazards=s.hazards.filter(e),s.coins_list=s.coins_list.filter(e)}function $e(){const t=s.cam_x,e=s.speed,l=s.next_spawn_x,a=W(He,ke),r=W(Pe,Ie),n=s.last_platform_top,c=It.reduce((p,d)=>{const H=$-24-d,P=$-24-p;return Math.abs(H-n)<Math.abs(P-n)?d:p},It[0]),i=It.slice(),M=e>520?3:2;for(let p=0;p<M;p++)i.push(c);const h=i[W(0,i.length-1)];let u=$-24-h;const y=e<520?170:125;Math.abs(u-n)>y&&(u=u>n?n+y:n-y);const m=S(Math.floor(l),Math.floor(u),Math.floor(a),Math.floor(r));s.platforms.push(m);let w=De;if(e>650&&(w*=.78),Math.random()<w){const p=W(30,68),d=W(32,62),H=Math.floor(e*Ae),P=Math.floor(e*ve);let b=W(Math.floor(l-P),Math.floor(l-H));b=Math.max(Math.floor(t+960+70),b);const C=Math.floor(e*Ce);b-s.last_hazard_x<C&&(b=s.last_hazard_x+C),s.last_hazard_x=b,b=T(b,m.x,m.x+m.w-p);const x=m.y+2;s.hazards.push(S(Math.floor(b),Math.floor(x-d),Math.floor(p),Math.floor(d)))}if(Math.random()<Re){const p=W(3,7),d=m.x+W(20,Math.max(20,m.w-20)),H=m.y-54,P=Math.random()<.55;for(let b=0;b<p;b++){const C=d+b*34,x=P?H-Math.floor(18*Math.sin(b/Math.max(1,p-1)*Math.PI)):H;s.coins_list.push(S(Math.floor(C),Math.floor(x),18,18))}}s.next_spawn_x=m.x+m.w+W(Te,Ee),s.last_platform_top=m.y}function tt(){s=zt(),At(),k.playerSquash=0,k.playerStretch=0}function Ge(){f.money+=Math.floor(s.coins_run*s.coin_mul),f.best_score=Math.max(f.best_score,s.score),F(f)}function ht(t=!1){f.best_score=Math.max(f.best_score,s.score),t&&F(f)}function Jt(t){j(!0),o.fillStyle=I([24,26,36]),o.fillRect(0,0,960,72),j(!1),o.strokeStyle=I([60,64,80]),o.lineWidth=2,o.beginPath(),o.moveTo(0,72),o.lineTo(960,72),o.stroke(),_(t,18,16,58,[245,245,250]),_(`Money: ${f.money}`,750,24,30,[245,245,250])}function pt(t,e,l,a){return j(!0),N(t,e,l,a,18,[26,28,40],[80,86,108],2),j(!1),S(t,e,l,a)}function je(t,e,l){Q(s.cam_x,l),o.fillStyle=I(ne),o.fillRect(0,Math.floor($+e),960,Vt),o.fillStyle="rgba(255,255,255,0.10)",o.fillRect(0,Math.floor($+e),960,6);const a=lt("platform");for(const p of s.platforms){const d=rt(p);d.x=Math.floor(d.x-s.cam_x+t),d.y=Math.floor(d.y+e),j(!0),o.fillStyle=I(a),o.fillRect(d.x,d.y,d.w,d.h),j(!1),o.fillStyle="rgba(255,255,255,0.15)",o.fillRect(d.x,d.y,d.w,3)}const r=lt("spike");for(const p of s.hazards){const d=rt(p);d.x=Math.floor(d.x-s.cam_x+t),d.y=Math.floor(d.y+e),de(d,r)}const n=1+.08*Math.sin(l*10);for(const p of s.coins_list){const d=rt(p);d.x=Math.floor(d.x-s.cam_x+t),d.y=Math.floor(d.y+e);const H=d.x+d.w/2,P=d.y+d.h/2,b=d.w/2*n,C=d.h/2*n;o.fillStyle="rgba(255,215,90,0.18)",o.beginPath(),o.ellipse(H,P,b+6,C+6,0,0,L),o.fill(),o.fillStyle=I(ce),o.beginPath(),o.ellipse(H,P,b,C,0,0,L),o.fill(),o.strokeStyle=I([255,240,170]),o.lineWidth=2,o.beginPath(),o.ellipse(H,P,Math.max(2,b-3),Math.max(2,C-3),0,0,L),o.stroke();const x=.5+.5*Math.sin(l*6+p.x*.02);o.fillStyle=`rgba(255,255,255,${.25*x})`,o.beginPath(),o.arc(H+4,P-4,2.2,0,L),o.fill()}for(const p of s.particles){const d=Math.floor(p.x-s.cam_x+t),H=Math.floor(p.y+e),P=T(p.life/p.maxLife,0,1);o.fillStyle=Gt(p.col,.85*P),o.beginPath(),o.arc(d,H,p.r,0,L),o.fill()}const c=rt(s.player);c.x=Math.floor(c.x-s.cam_x+t),c.y=Math.floor(c.y+e);const i=1-.1*k.playerSquash,h=1+.14*k.playerStretch,u=i,y=lt("player"),m=c.x+c.w/2,w=c.y+c.h/2;o.save(),o.translate(m,w),o.scale(h,u),j(!0),N(-c.w/2,-c.h/2,c.w,c.h,10,y,null,0),j(!1),o.restore(),o.fillStyle=I([10,12,16]),N(c.x+10,c.y+16,7,7,3,[10,12,16],null,0),N(c.x+26,c.y+16,7,7,3,[10,12,16],null,0),_(`Score: ${s.score}`,18,12,30,Tt),_(`Coins: ${s.coins_run}`,18,42,30,Tt),_(`Best: ${f.best_score}`,240,12,30,nt),f.settings.show_fps&&_(`FPS: ${_t|0}`,840,12,24,nt)}function Be(){o.fillStyle="rgba(0,0,0,0.58)",o.fillRect(0,0,960,540),_("Paused",960/2,540/2-64,64,[245,245,250],"center"),_("Press P to resume | ESC to menu",960/2,540/2+10,30,[220,220,235],"center")}function Le(){tt(),O=!1,g=q,E.click()}function Fe(){g=ut,E.click()}function Ne(){g=kt,E.click()}function Ue(){ht(!0),Ot=!1,E.click()}let vt="player",dt=!1,Kt=g;function qe(t){g!==Kt&&(k.uiFade=0,Kt=g),k.uiFade=T(k.uiFade+t*3.2,0,1)}function Ve(t,e,l,a){Q(0,et);const r=v(k.uiFade),n=pt(90,90,780,360),c=S(n.x+32,n.y+32,n.w-64,n.h-64);o.globalAlpha=r,_("Endless Runner",c.x,c.y,64,[245,245,250]);const i=c.y+64+18;_(`Best Score: ${f.best_score}`,c.x,i,30,[220,220,235]),_(`Money: ${f.money}`,c.x,i+38,30,[220,220,235]);const M=new A(S(c.x+c.w-200,c.y+6,200,54),"Quit",Ue,"sub"),h=c.x+c.w-330;let u=c.y+6+54+18;_("Equipped",h,u,30,[245,245,250]),u+=32,_(`Player: ${f.cosmetics.player}`,h,u,24,[220,220,235]),u+=24,_(`Platform: ${f.cosmetics.platform}`,h,u,24,[220,220,235]),u+=24,_(`Spikes: ${f.cosmetics.spike}`,h,u,24,[220,220,235]),u+=24,_(`Background: ${f.cosmetics.background}`,h,u,24,[220,220,235]),u+=30,_("Upgrades",h,u,30,[245,245,250]),u+=32;for(const x of["jump","coyote","coin_mult","magnet"])_(`${z[x].name}: ${f.upgrades[x]}/${z[x].max}`,h,u,24,[220,220,235]),u+=24;const y=260,m=54,w=16,p=c.x,d=i+120,H=m*3+w*2,P=c.y+c.h-H,b=T(d,c.y+160,P),C=[new A(S(p,b,y,m),"Play",Le,"main"),new A(S(p,b+(m+w),y,m),"Shop",Fe,"main"),new A(S(p,b+2*(m+w),y,m),"Settings",Ne,"main"),M];for(const x of C)x.draw(t,e,a);if(l){for(const x of C)if(x.tryClick(t,e))break}o.globalAlpha=1,_("Tip: Tap/Click to jump on mobile",942,512,18,nt,"right",.75)}function Xe(t,e,l,a){Q(0,et),Jt("Shop");const r=pt(18,90,924,432),n=S(r.x+18,r.y+18,420,r.h-36),c=S(n.x+n.w+18,n.y,r.w-n.w-54,n.h);N(n.x,n.y,n.w,n.h,16,[22,24,34],[70,74,92],2),N(c.x,c.y,c.w,c.h,16,[22,24,34],[70,74,92],2),_("Cosmetics",n.x+16,n.y+14,30,[245,245,250]),_("Upgrades",c.x+16,c.y+14,30,[245,245,250]);const i=[];i.push(new A(S(780,80,160,44),"Back",()=>{g=U,E.click()},"sub"));const M=["player","platform","spike","background"];let h=n.y+58;const u=n.x+16;for(const x of M){const G=x.charAt(0).toUpperCase()+x.slice(1);i.push(new A(S(u,h,188,40),G,()=>{vt=x,E.click()},vt===x?"main":"sub")),h+=50}const y=vt,m=Object.entries(Ht[y]).slice().sort((x,G)=>x[1].price-G[1].price),w=n.x+16;_(`Category: ${y.charAt(0).toUpperCase()+y.slice(1)}`,w,n.y+220,24,[220,220,235]);let p=n.y+270;const d=44,H=Math.floor((n.y+n.h-(p+10))/d),P=m.slice(0,H);for(const[x,G]of P){const ot=qt(y,x),xt=f.cosmetics[y]===x,$t=xt?"Equipped":ot?"Equip":`Buy ${G.price}`,se=()=>re(y,x);i.push(new A(S(w,p,240,40),`${x}`,se,"sub")),i.push(new A(S(w+250,p,140,40),$t,se,xt?"main":"sub"));const gt=S(w+402,p+8,24,24);N(gt.x,gt.y,gt.w,gt.h,6,G.color,[90,96,120],2),p+=d}let b=c.y+58;const C=c.x+16;for(const x of["jump","coyote","coin_mult","magnet"]){const G=f.upgrades[x],ot=z[x].max,xt=G<ot?Ut(x,G):null;_(`${z[x].name}`,C,b,24,[240,240,245]),_(`Level: ${G}/${ot}`,C,b+22,22,[200,200,210]);const $t=G>=ot?"MAX":`Buy ${xt}`;i.push(new A(S(c.x+c.w-180,b+6,160,40),$t,()=>ae(x),"sub")),b+=74}for(const x of i)x.draw(t,e,a);if(l){for(const x of i)if(x.tryClick(t,e))break}}function ze(t,e,l,a){Q(0,et),Jt("Settings");const r=pt(18,90,924,432);let n=r.x+22,c=r.y+42;const i=[];i.push(new A(S(780,80,160,44),"Back",()=>{g=U,E.click()},"sub"));const M=()=>{dt?(dt=!1,fe(),E.click()):(dt=!0,E.click())};i.push(new A(S(n,c,340,44),dt?"CONFIRM Reset Save":"Reset Save",M,"main")),c+=80,_("Basic",n,c,30,[245,245,250]),c+=52;const h=[["screenshake","Screen Shake"],["particles","Particles"],["show_fps","Show FPS"],["sound","Sound"],["fullscreen","Fullscreen"]];for(const[m,w]of h){const p=f.settings[m];i.push(new A(S(n,c,340,44),`${w}: ${p?"On":"Off"}`,()=>ie(m),"sub")),c+=60}const u=r.x+r.w/2+40;let y=r.y+130;_("Controls",u,y,30,[245,245,250]),y+=52,_("W / SPACE / TAP  Jump",u,y,22,[220,220,235]),_("P                Pause",u,y+26,22,[220,220,235]),_("R                Restart run",u,y+52,22,[220,220,235]),_("ESC              Back/Menu",u,y+78,22,[220,220,235]);for(const m of i)m.draw(t,e,a);if(l){for(const m of i)if(m.tryClick(t,e))break}}function Ye(t,e,l,a){Q(s.cam_x,et);const r=pt(120,120,720,300);let n=r.x+40,c=r.y+26;_("You Died",n,c,64,[245,245,250]),c+=92,_(`Run Score: ${s.score}`,n,c,30,[235,235,245]),c+=38;const i=Math.floor(s.coins_run*s.coin_mul);_(`Run Coins: ${s.coins_run}   Payout: ${i}`,n,c,30,[235,235,245]),c+=38,_(`Money: ${f.money}`,n,c,30,[235,235,245]),c+=38,_(`Best: ${f.best_score}`,n,c,30,nt);const M=260,h=54,u=16,y=r.x+r.w-40-M,m=h*3+u*2,w=r.y+r.h/2-m/2,p=T(w,r.y+70,r.y+r.h-40-m),d=[new A(S(y,p,M,h),"Play again",()=>{tt(),O=!1,g=q,E.click()},"main"),new A(S(y,p+h+u,M,h),"Shop",()=>{g=ut,E.click()},"sub"),new A(S(y,p+2*(h+u),M,h),"Menu",()=>{O=!1,g=U,E.click()},"sub")];for(const H of d)H.draw(t,e,a);if(l){for(const H of d)if(H.tryClick(t,e))break}}function Je(t,e,l,a){s.speed=T(s.speed+xe*t,Xt,_e),s.score_f+=s.speed*t*.02,s.score=Math.floor(s.score_f),ht(!1),e?s.jump_buf=Se:s.jump_buf=Math.max(0,s.jump_buf-t),s.on_ground?(s.coyote=s.coyote_t,s.jump_cut=!1):s.coyote=Math.max(0,s.coyote-t),s.on_ground?s.jump_time=0:s.jump_time+=t,s.jump_buf>0&&s.coyote>0&&(s.vy=-s.jump_v,s.on_ground=!1,s.coyote=0,s.jump_buf=0,s.jump_cut=!1,s.jump_time=0,k.playerStretch=1,E.jump()),s.vy=T(s.vy+ge*t,-5e3,we),a&&!s.on_ground&&!s.jump_cut&&s.vy<0&&(s.vy*=ye,s.jump_cut=!0);const r=s.player;r.x=Math.floor(s.cam_x+160);const n=s.vy*t,c=s.on_ground;s.on_ground=!1;const i=me(r,s.py,n,s.platforms);s.py=i.pyFloat,r.y+r.h>=$?s.vy>0&&(r.y=$-r.h,s.py=r.y,s.vy=0,s.on_ground=!0,c||(k.playerSquash=1,ft(s.particles,J(r),r.y+r.h,10,90,240,.25,.55,2,4.5,[230,230,240],!0))):i.landed&&(s.vy=0,s.on_ground=!0,c||(k.playerSquash=1,ft(s.particles,J(r),r.y+r.h,8,90,240,.25,.55,2,4.5,[230,230,240],!0))),s.cam_x+=s.speed*t,At(),Oe();const M=s.magnet_px;if(M>0)for(const u of s.coins_list){const y=J(r)-J(u),m=at(r)-at(u),w=Math.hypot(y,m);if(.1<w&&w<M){const p=(M-w)/M;u.x+=Math.trunc(y*p*t*2.8),u.y+=Math.trunc(m*p*t*2.8)}}const h=[];for(let u=0;u<s.coins_list.length;u++){const y=s.coins_list[u];it(r,y)&&(h.push(u),s.coins_run+=1,k.coinPulse=1,E.coin(),ft(s.particles,J(y),at(y),12,90,280,.25,.65,2,4.2,[255,235,160],!1),Yt(2,.08))}if(h.length){const u=new Set(h);s.coins_list=s.coins_list.filter((y,m)=>!u.has(m))}for(const u of s.hazards)if(it(r,u)){ft(s.particles,J(r),at(r),22,180,520,.35,.95,2,5,[240,90,90],!1),Yt(10,.25),Ge(),ht(!0),E.dead(),g=Pt;return}pe(s.particles,t),s.shake_t>0?(s.shake_t-=t,s.shake_t<=0&&(s.shake_mag=0)):s.shake_mag=Math.max(0,s.shake_mag-t*12),k.playerSquash=Math.max(0,k.playerSquash-t*6),k.playerStretch=Math.max(0,k.playerStretch-t*7),k.coinPulse=Math.max(0,k.coinPulse-t*9)}function Ke(t){let e=0,l=0;if(s.shake_mag>.01&&s.shake_t>0&&f.settings.screenshake){const a=s.shake_mag;e=W(-Math.floor(a),Math.floor(a)),l=W(-Math.floor(a*.6),Math.floor(a*.6))}if(je(e,l,t),k.coinPulse>.001){const a=.08*k.coinPulse;o.fillStyle=`rgba(255,215,90,${a})`,o.fillRect(0,0,960,540)}}let Ct=0,Dt=0,Rt=!1;const mt=new Set;let yt=!1,Wt=!1;function Zt(t,e){return{gx:t-bt,gy:e-St}}window.addEventListener("mousemove",t=>{const e=Zt(t.clientX,t.clientY);Ct=e.gx,Dt=e.gy});function Qt(t){const e=Zt(t.clientX,t.clientY);Ct=e.gx,Dt=e.gy,Rt=!0,g===q&&!O&&(yt=!0)}window.addEventListener("mousedown",t=>{t.button===0&&Qt(t)}),window.addEventListener("pointerdown",t=>{t.pointerType==="mouse"&&t.button!==0||Qt(t)},{passive:!0}),window.addEventListener("keydown",t=>{mt.add(t.code),(t.code==="KeyW"||t.code==="Space")&&(yt=!0),t.code==="KeyP"&&g===q&&(O=!O,E.click()),t.code==="KeyR"&&g===q&&(tt(),O=!1,E.click()),t.code==="Escape"&&(ht(!0),g===q?(O=!1,g=U):g===ut||g===kt||g===Pt?g=U:Ot=!1,f.settings.fullscreen&&Et(!1),E.click())}),window.addEventListener("keyup",t=>{mt.delete(t.code),(t.code==="KeyW"||t.code==="Space")&&g===q&&(Wt=!0)});function Ze(){return mt.has("KeyW")||mt.has("Space")}tt(),At();let Ot=!0,te=performance.now(),ee=0,_t=60;const Qe=.08;let et=0;function oe(t){if(!Ot)return;const e=T((t-te)/1e3,0,.05);te=t,ee+=e,et=t/1e3;const l=e>0?1/e:60;_t=_t+(l-_t)*Qe,qe(e);const a=Rt;Rt=!1;const r=yt,n=Wt;yt=!1,Wt=!1,o.setTransform(V,0,0,V,0,0),o.fillStyle="black",o.fillRect(0,0,K,Z),o.save(),o.translate(bt,St),o.beginPath(),o.rect(0,0,960,540),o.clip();const c=Ct,i=Dt;g===U?Ve(c,i,a,e):g===ut?Xe(c,i,a,e):g===kt?ze(c,i,a,e):g===Pt?Ye(c,i,a,e):g===q&&(O||Je(e,r,Ze(),n),Ke(ee),O&&Be()),o.restore(),requestAnimationFrame(oe)}requestAnimationFrame(oe)})();
